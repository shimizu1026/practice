<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自動ジグザグスクラッチ</title>
    <style>
        /* CSSは前回とまったく同じです */
        body {
            margin: 0;
            padding: 0;
            overflow: hidden; 
        }
        #background-container {
            width: 100vw; 
            height: 100vh; 
            background-image: url('https://source.unsplash.com/random/1920x1080?architecture'); /* 画像URLは好きに変えてください */
            background-size: cover; 
            background-position: center; 
            position: relative; 
        }
        #scratch-canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
</head>
<body>

    <div id="background-container"></div>
    <canvas id="scratch-canvas"></canvas>

<script>
    // ページが読み込まれたら処理を開始
    window.addEventListener('load', function() {
        console.log("1. ページが読み込まれました (window.load)");

        // --- 1. 要素の取得 ---
        const canvas = document.getElementById('scratch-canvas');
        const ctx = canvas.getContext('2d');
        console.log("2. キャンバスとコンテキストを取得しました。");


        // --- 3. キャンバスの初期設定 ---
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        ctx.fillStyle = 'black';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        console.log("3. キャンバスを黒で塗りつぶしました。");

        // --- 4. ジグザグアニメーションの準備 ---
        const brushSize = 100; // 削る幅（線の太さ）
        const speed = 25; 
        let currentX = 0;
        let currentY = brushSize; 
        let direction = 1;
        
        let lastX = 0;
        let lastY = brushSize;

        // --- 5. ★変更点: 「線」で削る処理 ---
        function drawSmoothLine() {
            // 「削る」モードに設定
            ctx.globalCompositeOperation = 'destination-out';
            ctx.lineWidth = brushSize; // 線の太さ
            ctx.lineCap = 'round'; // 線の端を丸くする
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY); // 前回の位置
            ctx.lineTo(currentX, currentY); // 現在の位置
            ctx.stroke(); // 線を引く（削る）

            // 現在位置を「前回の位置」として保存
            lastX = currentX;
            lastY = currentY; 
        }

        // --- 6. ジグザグアニメーションの実行 ---
        function autoZigzagScratch() {
            
            // 1. ★変更点: 「線」で削る関数を呼び出す
            drawSmoothLine();

            // 2. X座標を更新
            currentX += (speed * direction);

            // 3. 端に来たかの判定
            if (currentX >= canvas.width - (brushSize / 2) && direction === 1) {
                direction = -1; 
                currentY += brushSize; 
                lastY = currentY; // Y座標も更新
            }
            else if (currentX <= 0 + (brushSize / 2) && direction === -1) {
                direction = 1; 
                currentY += brushSize; 
                lastY = currentY; // Y座標も更新
            }

            // 4. 終了判定
            if (currentY > canvas.height + brushSize) {
                console.log("7. アニメーションが完了しました。");
                return; // アニメーション停止
            }
            
            // 5. 次のフレームを呼ぶ
            requestAnimationFrame(autoZigzagScratch);
        }

        // アニメーションを開始
        console.log("6. アニメーションを開始します。");
        autoZigzagScratch();
        
    }, false); 
</script>
    </body>
</html>